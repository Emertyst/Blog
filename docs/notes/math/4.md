# 广义容斥原理与二项式反演

## 容斥原理

~~先来复习一下容斥原理~~

设 $\mathbf S_1, \mathbf S_2, \cdots, \mathbf S_n$ 为有限集，则：

$$
\left|\bigcup_{i = 1}^n \mathbf S_i\right| = \sum_{1 \leq i \leq n} \left|\mathbf S_i\right| - \sum_{1 \leq i, j \leq n} \left|\mathbf S_i \cap \mathbf S_j \right| + \cdots + (-1)^{n - 1} \left|\bigcap_{i = 1}^n \mathbf S_i\right| \\
$$

## 广义容斥原理

### 定义

容斥原理可以看成给定 $n$ 个条件，求不满足任何一个条件的元素个数。广义容斥原理则是求恰好满足 $k$ 个条件的情况个数。

!!! abstract "广义容斥原理"

    给定 $n$ 个条件，设 $f(x)$ 为恰好满足 $k$ 个条件的情况数，$g(x)$ 为钦定 $x$ 个条件必须满足，**剩下的条件满不满足都行**的情况数，也就是：

    $$
    g(x) = \sum_{i = x}^n \binom{i}{x} f(x) \\
    $$

    那么有：

    $$
    f(x) = \sum_{i = x}^n (-1)^{i - x} \binom{i}{x} g(i) \\
    $$

!!! info "为什么 $g(x)$ 可以用 $f(x)$ 表示"

    假设我们使用 $f(x)$ 的钦定方式选出恰好满足的 $x$ 个条件，它们构成集合 $\mathbf S$；使用 $g(x)$ 的钦定方式选出必须满足的 $y$ 个条件，它们构成集合 $\mathbf T$（其中，第一种钦定方式只对应一种情况，第二种钦定方式对应多种情况）。第一种钦定方式对应的情况如果对第二种钦定方式有贡献，当且仅当 $\mathbf T \subset \mathbf S$。也就是说，每一种恰好满足 $i$ 个条件的情况，对 $g(x)$ 的贡献为 $\dbinom{i}{x}$，而恰好满足 $i$ 个条件的情况数为 $f(x)$，因此有了上面的关系。

（广义容斥原理的证明在下文）

### 应用

~~咕~~

## 二项式反演

### 定义

!!! abstract "二项式反演的四种形式"

    $$
    \begin{aligned}
        & f(x) = \sum_{i = 0}^x (-1)^i \binom{x}{i} g(i) & \iff & g(x) = \sum_{i = 0}^x (-1)^i \binom{x}{i} f(i) & \\
        & f(x) = \sum_{i = 0}^x \binom{x}{i} g(i) & \iff & g(x) = \sum_{i = 0}^x (-1)^{x - i} \binom{x}{i} f(i) & \\
        & f(x) = \sum_{i = x}^n (-1)^i \binom{i}{x} g(i) & \iff & g(x) = \sum_{i = x}^n (-1)^i \binom{i}{x} f(i) & \\
        & f(x) = \sum_{i = x}^n \binom{i}{x} g(i) & \iff & g(x) = \sum_{i = x}^n (-1)^{i - x} \binom{i}{x} f(i) & \\
    \end{aligned}
    $$

广义容斥原理即形式 4。

### 证明

!!! info "前置知识"

    $$
    \begin{aligned}
        \binom{a}{b}\binom{b}{c} &= \frac{a!}{b! (a - b)!} \times \frac{b!}{c! (b - c)!} \\
        &= \frac{a!}{(a - b)! c! (b - c)!} \\
        &= \frac{(a - c)!}{(a - b)! (b - c)!} \times \frac{a!}{c! (a - c)!} \\
        &= \binom{a - c}{b - c}\binom{a}{c} \\
        &= \binom{a - c}{a - b}\binom{a}{c} \\
    \end{aligned}
    $$

!!! info "形式 1"

    将 $f(x) = \displaystyle\sum_{i = 0}^x (-1)^i \dbinom{x}{i} g(i)$ 代入 $\displaystyle\sum_{i = 0}^x (-1)^i \dbinom{x}{i} f(i)$，得：

    $$
    \begin{aligned}
        \sum_{i = 0}^x (-1)^i \binom{x}{i} f(i) &=
        \sum_{i = 0}^x (-1)^i \binom{x}{i} \sum_{j = 0}^i (-1)^j \binom{i}{j} g(j) \\
        &= \sum_{i = 0}^x\sum_{j = 0}^i (-1)^{i + j} \binom{x}{i}\binom{i}{j} g(j) \\
        &= \sum_{j = 0}^x\sum_{i = j}^x (-1)^{i + j} \binom{x - j}{i - j}\binom{x}{j} g(j) \\
        &= \sum_{j = 0}^x \binom{x}{j} g(j) \sum_{i = j}^x (-1)^{i + j} \binom{x - j}{i - j} \\
        &= \sum_{j = 0}^x \binom{x}{j} g(j) \sum_{i = 0}^{x - j} (-1)^i \binom{x - j}{i} \\
        &= g(x) + \sum_{j = 0}^{x - 1} \binom{x}{j} g(j) \sum_{i = 0}^{x - j} (-1)^i \binom{x - j}{i} \\
        &= g(x) + \sum_{j = 0}^{x - 1} \binom{x}{j} g(j) (1 - 1)^{x - j} \\
        &= g(x) \\
    \end{aligned}
    $$

    因为两侧的形式是对称的，所以形式 1 得证。

!!! info "形式 2"

    $$
    \begin{aligned}
        f(x) &= \sum_{i = 0}^x \binom{x}{i} g(i) \\
        &= \sum_{i = 0}^x (-1)^i \binom{x}{i} (-1)^i g(i) \\
        \text{令 } G(x) &= (-1)^x g(x) \\
        f(x) &= \sum_{i = 0}^x (-1)^i \binom{x}{i} G(i) \\
        G(x) &= \sum_{i = 0}^x (-1)^i \binom{x}{i} f(i) \\
        (-1)^x g(x) &= \sum_{i = 0}^x (-1)^i \binom{x}{i} f(i) \\
        g(x) &= \sum_{i = 0}^x (-1)^{x - i} \binom{x}{i} f(i) \\
    \end{aligned}
    $$

    因为变换均等价，所以形式 2 得证。

!!! info "形式 4"

    $$
    \begin{aligned}
        f(x) &= \sum_{i = x}^n \binom{i}{x} g(i) \\
        f(n - x) &= \sum_{i = n - x}^n \binom{i}{n - x} g(i) \\
        &= \sum_{i = 0}^x \binom{n - i}{n - x} g(n - i) \\
        \frac{f(n - x)}{\binom{n}{x}} &= \sum_{i = 0}^x \frac{\binom{n - i}{n - x}}{\binom{n}{x}} g(n -i) \\
        \frac{f(n - x)}{\binom{n}{n - x}} &= \sum_{i = 0}^x \binom{x}{i} \frac{g(n - i)}{\binom{n}{i}} \\
        \text{令 } F(x) &= \frac{f(n - x)}{\binom{n}{n - x}}, G(x) = \frac{g(n - x)}{\binom{n}{n - x}} \\
        F(x) &= \sum_{i = 0}^x \binom{x}{i} G(i) \\
        G(x) &= \sum_{i = 0}^x (-1)^{x - i} \binom{x}{i} F(i) \\
        \frac{g(n - x)}{\binom{n}{x}} &= \sum_{i = 0}^x (-1)^{x - i} \binom{x}{i} \frac{f(n - i)}{\binom{n}{i}} \\
        \frac{g(n - x)}{\binom{n}{x}} &= \sum_{i = 0}^x (-1)^{x - i} \binom{x}{i} \frac{f(n - i)}{\binom{n}{i}} \\
        \frac{g(n - x)}{\binom{n}{x}} &= \sum_{i = 0}^x (-1)^{x - i} \frac{\binom{n - i}{n - x}}{\binom{n}{x}} f(n - i) \\
        g(n - x) &= \sum_{i = 0}^x (-1)^{x - i} \binom{n - i}{n - x} f(n - i) \\
        g(n - x) &= \sum_{i = n - x}^n (-1)^{x - n + i} \binom{i}{n - x} f(i) \\
        g(n - x) &= \sum_{i = n - x}^n (-1)^{n - x - i} \binom{i}{n - x} f(i) \\
        g(x) = &= \sum_{i = x}^n (-1)^{x - i} \binom{i}{x} f(i) \\
    \end{aligned}
    $$

    因为变换均等价，所以形式 4 得证。

!!! info "形式 3"

    $$
    \begin{aligned}
        f(x) &= \sum_{i = x}^n (-1)^i \binom{i}{x} g(i) \\
        &\text{令 } G(x) = (-1)^x g(x) \\
        f(x) &= \sum_{i = x}^n \binom{i}{x} G(i) \\
        G(x) &= \sum_{i = x}^n (-1)^{x - i} \binom{i}{x} f(i) \\
        (-1)^x g(x) &= \sum_{i = x}^n (-1)^{x - i} \binom{i}{x} f(i) \\
        g(x) &= \sum_{i = x}^n (-1)^i \binom{i}{x} f(i) \\
    \end{aligned}
    $$

    因为变换均等价，所以形式 3 得证。

比起广义容斥原理，二项式反演的其他形式更像是一种公式，组合意义较少。

### 应用

~~咕~~